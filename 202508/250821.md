# 📆 2025-08-21 (목)
## 🥅 오늘 목표 
- [ ] 일 목표한 것들 하기 
- [ ] 여행 계획 세우기 

## ☑️ 오늘 한 일 📑 ( 목표하지 않았지만 추가된 것들 )

***

## 🔍️ 오늘 무엇을 했나요? Review
### [WORK] 
코드 리뷰를 남기면서 내가 모르는 부분에 대해서도 검색해보고 학습함 

#### `@Generated` 어노테이션
#### `@Generated` 와 `entityManager.refresh()`

#### 추가 개발 사항 요건에 대해서 의견 제시 
추가 개발사항이 들어왔을 때, 먼저 문제부터 다시 재정의하고 그 문제에 대해서 더 적절한 해결책과 근거를 제시함.
의사결정에 도움이 될 수 있도록 제안한 해결책으로 개발을 진행했을 때 어떤 작업들이 이루어져야 하는지도 같이 제시하였음. 이에 해당 요구사항에 대해  비즈니스에 꼭 필요한 부분인가  재논의 후 필요치 않다고 판단되어 개발을 진행하지 않기로 함. 개발 리소스와 일정이 부족한 상태에서 꼭 필요한 일인가에 대해 상기시켜 일정과 리소스 관리에 기여함 

#### 일괄 처리 로직 성능을 개선하기 위해 문제점 찾고 해결책 제시 
원래 50건 정도 등록할 때 17초가 넘게 걸렸으나, 해결 후 100개 등록시 15초로 줄임.
1건당 평균 처리 시간 기준으로 보면 약 56% 정도 성능이 향상되었으며, 전체 등록 시간도 약 12% 단축

##### 의심되는 원인
- 레거시 DB에 member를 등록하고 신규 member와 매핑하기 위해 신규 회원 저장시 레거시 db pk를 발급해서 레거시에 넣어주는 형태로 되어있음
  - 시퀀스를 활용하여 member를 생성할 때마다 시퀀스 조회를 함. 
  - 대량 회원가입시, 루프를 돌면서 계속 시퀀스를 조회하기 때문에 성능이 저하됨 
    - DB에 접근하는 것은 애플리케이션 메모리에서 연산하는 것보다 훨씬 비쌈
    - 퀀스 조회처럼 단순한 연산이라도 횟수가 많으면 전체 트래픽을 잡아먹음
    - DB와 연결할 수 있는 커넥션 수는 제한되어 있으며, 반복적인 조회로 인해 커넥션 풀이 고갈되면 대기 시간 증가 또는 접속 지연이 발생
    - DB 호출은 네트워크 통신을 수반하므로, 호출-응답 간 시간 동안 쓰레드가 블로킹되거나 컨텍스트 스위칭이 반복되어 CPU 효율이 낮아짐
    - 대량 처리 시 루프마다 DB에 접근하면 수백~수천 번의 네트워크 I/O가 발생하여 DB에 과부하
  - 또, 이렇게 구현할 경우 시퀀스는 트랜잭션이 실패해도 롤백이 되지 않기때문에 시퀀스가 널뜀 

##### 해결방안
- 신규 DB의 레거시 db pk에 기존에 사용중이던 시퀀스를 디폴트 값으로 지정하여 DB가 생성하도록 책임을 넘김
- 이전에도 해당 방법을 고안했으나, JPA의 insert 정책은 전체 필드에 대해서 쿼리를 생성하여 요청함. 
- 이렇게되면 쿼리에 `INSERT members (...생략 ) old_member_id = null` 이런식으로 요청되기 때문에 디폴트가 저장되지 않고 `null`이 들어감
- 디폴트 값이 적용되려면 인서트시 필드를 선언하면 안됨
- 이를 처리하기 위해서 JPA에서 제공하는 기능으로 `@DynamicInsert`가 있음 이것을 사용하면 명시적으로 입력된 값에 대해서만 인서트 쿼리를 날림. 
  - 사용시 주의해야 할 점은 명시적으로 입력된 값에 대해서마 인서트를 날리기 때문에, 코드에서의 디폴트 DB에서 디폴트 처리를 잘 해줘야 함. 

 

##### 결과 
기존
- 50건의 데이터를 등록하는 데 약 17초

개선후
- 100건의 데이터를 등록하는 데 약 15초

요약
- 1건당 평균 처리 시간 기준으로 보면 약 56% 정도 성능이 향상되었으며, 전체 등록 시간도 약 12% 단축


## 💡 오늘 회고
하고있던 패키지 입과 지원업무 + 운영툴 개선 쬐금 정도만 업무를 하고 나머지는 동료의 일 도와주기 + 문서 정리? 요건 정리를 했다. 
페어 프로그래밍? 보다는 같이 업무 파악하기? 도 재밌었음. 담엔 찐으로 코딩을 페어 프로그래밍하면 재밌을 듯. 
이번주는 왜인지 엔지니어보다는 뭔가 매니징?이라고 표현하기는 뭐하지만 여튼 누굴 도와주고 문제 같이 보고 해결책 제시하고 방향을 자시 잡아주고 그런 일을 많이 한거 같다. 이것도 나름 재밌었다. 주니어에서 조금은 더 성장한 것 같고. 

오늘 오전 업무하는데 눈이 침침했다. 그러더니 눈이 엄청 흐릿해지면서 잘 안보여서 당황했다. 당장 멘션 온 글을 읽어야하는데 글자가 안보여서 간신히 대충 흐릿하게 보이는 실루엣?으로 읽어서 답변을 했다. 병원갔더니 컨디션이 안좋으면 일시적으로 그럴 수 있다고 했다. 오후에는 오른쪽에 벌레 물린(??)거 같은 곳이 약먹고 나니깐 바로 좋아져서 눈이 잘 안보이는 현상은 없었다. (의사쌤이 오른쪽 눈 부은거랑 상관없다고했는데 우연이랬는데 자꾸 우연이 들어맞음..) 
코로나 이후로 아니 그 전부터 계속 면역이 별로 안좋아서 그런 영향이 있는 듯 하다. 올 초인가 작년 연말에도 눈이 급격히 안좋아진거 같다고 했었는데, 그래서 안경도 두개나 새로 맞췄다. ㅎ.. 관리 잘해야지. 하고싶은거하고 살려구 일하는건데 일 때문에 건강을 망치고 싶진 않다. 


## 🎯 내일 할 일
***

## 🏁 이번주 목표 🏁
